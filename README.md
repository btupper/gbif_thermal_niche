gbifniche
================

R tool for assessing uncertainties around qualities of observation for
environmental niches using GBIF data

## Requirements

-   [R v4.1](https://www.r-project.org/)
-   [rlang](https://CRAN.R-project.org/package=rlang)
-   [dplyr](https://CRAN.R-project.org/package=dplyr)
-   [readr](https://CRAN.R-project.org/package=readr)
-   [ggplot2](https://CRAN.R-project.org/package=ggplot2)
-   [rgbif](https://CRAN.R-project.org/package=rgbif)
-   [rappdirs](https://CRAN.R-project.org/package=rappdirs)
-   [mapr](https://CRAN.R-project.org/package=mapr)

## Installation

    remotes::install_github("kolive4/gbif_thermal_niche")

## Usage

Retrieve a data set by species.

``` r
suppressPackageStartupMessages({
  library(gbifniche)
  library(dplyr)
})

# make it quiet for the purpose of the README markdown
x = fetch_gbif(species = "Squalus acanthias subsp. acanthias Linnaeus, 1758", 
               verbose = FALSE, progress = FALSE) |>
  dplyr::glimpse()
```

    ## Rows: 9,704
    ## Columns: 79
    ## $ key                                     <chr> "3489356476", "18485333", "184…
    ## $ scientificName                          <chr> "Squalus acanthias acanthias",…
    ## $ decimalLatitude                         <dbl> 47.49023, 47.26000, 47.08000, …
    ## $ decimalLongitude                        <dbl> -6.18211, -58.44000, -58.21000…
    ## $ issues                                  <chr> "gass84", "gass84", "gass84", …
    ## $ datasetKey                              <chr> "6cbf7d4d-13cb-4604-8668-db68f…
    ## $ publishingOrgKey                        <chr> "1928bdf0-f5d2-11dc-8c12-b8a03…
    ## $ installationKey                         <chr> "07ea29ef-e386-4278-ae0f-09577…
    ## $ publishingCountry                       <chr> "FR", "CA", "CA", "CA", "CA", …
    ## $ protocol                                <chr> "DWC_ARCHIVE", "DWC_ARCHIVE", …
    ## $ lastCrawled                             <chr> "2022-04-20T10:46:55.512+00:00…
    ## $ lastParsed                              <chr> "2022-04-25T18:41:54.030+00:00…
    ## $ crawlId                                 <int> 169, 168, 168, 168, 168, 168, …
    ## $ hostingOrganizationKey                  <chr> "1928bdf0-f5d2-11dc-8c12-b8a03…
    ## $ basisOfRecord                           <chr> "HUMAN_OBSERVATION", "HUMAN_OB…
    ## $ occurrenceStatus                        <chr> "PRESENT", "PRESENT", "PRESENT…
    ## $ taxonKey                                <int> 6163063, 6163063, 6163063, 616…
    ## $ kingdomKey                              <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
    ## $ phylumKey                               <int> 44, 44, 44, 44, 44, 44, 44, 44…
    ## $ classKey                                <int> 121, 121, 121, 121, 121, 121, …
    ## $ orderKey                                <int> 883, 883, 883, 883, 883, 883, …
    ## $ familyKey                               <int> 5872, 5872, 5872, 5872, 5872, …
    ## $ genusKey                                <int> 2420869, 2420869, 2420869, 242…
    ## $ speciesKey                              <int> 5216368, 5216368, 5216368, 521…
    ## $ acceptedTaxonKey                        <int> 5216368, 5216368, 5216368, 521…
    ## $ acceptedScientificName                  <chr> "Squalus acanthias Linnaeus, 1…
    ## $ kingdom                                 <chr> "Animalia", "Animalia", "Anima…
    ## $ phylum                                  <chr> "Chordata", "Chordata", "Chord…
    ## $ order                                   <chr> "Squaliformes", "Squaliformes"…
    ## $ family                                  <chr> "Squalidae", "Squalidae", "Squ…
    ## $ genus                                   <chr> "Squalus", "Squalus", "Squalus…
    ## $ species                                 <chr> "Squalus acanthias", "Squalus …
    ## $ genericName                             <chr> "Squalus", "Squalus", "Squalus…
    ## $ specificEpithet                         <chr> "acanthias", "acanthias", "aca…
    ## $ infraspecificEpithet                    <chr> "acanthias", "acanthias", "aca…
    ## $ taxonRank                               <chr> "SUBSPECIES", "SUBSPECIES", "S…
    ## $ taxonomicStatus                         <chr> "SYNONYM", "SYNONYM", "SYNONYM…
    ## $ coordinateUncertaintyInMeters           <dbl> 256905, NA, NA, NA, NA, NA, NA…
    ## $ year                                    <int> 2017, 1994, 1994, 1994, 1994, …
    ## $ month                                   <int> 3, 1, 1, 2, 2, 2, 2, 2, 2, 2, …
    ## $ day                                     <int> 3, 21, 25, 7, 8, 1, 19, 19, 20…
    ## $ eventDate                               <chr> "2017-03-03T00:00:00", "1994-0…
    ## $ lastInterpreted                         <chr> "2022-04-25T18:41:54.030+00:00…
    ## $ license                                 <chr> "http://creativecommons.org/li…
    ## $ identifiers                             <chr> "none", "none", "none", "none"…
    ## $ facts                                   <chr> "none", "none", "none", "none"…
    ## $ relations                               <chr> "none", "none", "none", "none"…
    ## $ gadm                                    <chr> "none", "none", "none", "none"…
    ## $ isInCluster                             <lgl> FALSE, FALSE, FALSE, FALSE, FA…
    ## $ datasetID                               <chr> "6B38DF84-3005-38DF-E053-2614A…
    ## $ recordedBy                              <chr> "()", NA, NA, NA, NA, NA, NA, …
    ## $ inCluster                               <lgl> FALSE, FALSE, FALSE, FALSE, FA…
    ## $ geodeticDatum                           <chr> "WGS84", "WGS84", "WGS84", "WG…
    ## $ class                                   <chr> "Elasmobranchii", "Elasmobranc…
    ## $ countryCode                             <chr> "FR", "CA", "CA", "US", "US", …
    ## $ recordedByIDs                           <chr> "none", "none", "none", "none"…
    ## $ identifiedByIDs                         <chr> "none", "none", "none", "none"…
    ## $ country                                 <chr> "France", "Canada", "Canada", …
    ## $ eventID                                 <chr> "6CF446C4-4B65-145C-E053-2614A…
    ## $ identifier                              <chr> "6CF446C4-4B65-145C-E053-2614A…
    ## $ originalNameUsage                       <chr> "Squalus acanthias acanthias",…
    ## $ county                                  <chr> "Atlantique (plateau continent…
    ## $ associatedReferences                    <chr> "Mention dans le site Natura 2…
    ## $ identificationVerificationStatus        <chr> "Probable, high degree of reli…
    ## $ nameAccordingTo                         <chr> "Gargominy O (2021). TAXREF. V…
    ## $ occurrenceRemarks                       <chr> "WGS84", NA, NA, NA, NA, NA, N…
    ## $ gbifID                                  <chr> "3489356476", "18485333", "184…
    ## $ occurrenceID                            <chr> "6CF446C4-4B65-145C-E053-2614A…
    ## $ taxonID                                 <chr> "564065", NA, NA, NA, NA, NA, …
    ## $ name                                    <chr> "Squalus acanthias acanthias",…
    ## $ X.2b7c7b4f.4d4f.40d3.94de.c28b6fa054a6. <chr> NA, "2b7c7b4f-4d4f-40d3-94de-c…
    ## $ datasetName                             <chr> NA, "ECNASAP - East Coast Nort…
    ## $ rightsHolder                            <chr> NA, "Her Majesty the Queen in …
    ## $ catalogNumber                           <chr> NA, "27340.SPIDOG", "27371.SPI…
    ## $ institutionCode                         <chr> NA, "DFO-NG", "DFO-NG", "NMFS-…
    ## $ locality                                <chr> NA, "Stratum.303", "Stratum.71…
    ## $ collectionCode                          <chr> NA, "20.45", "20.45", "DE.17",…
    ## $ language                                <chr> NA, "En", "En", "En", "En", "E…
    ## $ type                                    <chr> NA, "Dataset", "Dataset", "Dat…

If you have downloaded multiple datasets you can list the ones you have.

``` r
(spp <- list_gbif())
```

    ## [1] "Carcharodon carcharias"                           
    ## [2] "Prionace glauca"                                  
    ## [3] "Squalus acanthias subsp. acanthias Linnaeus, 1758"

Now that you have a set of data files you can read them, optionally with
a select number of [GBIF Darwin
Core](https://ipt.gbif.org/manual/en/ipt/2.5/occurrence-data) required
and recommended fields.

``` r
x <- read_gbif(spp[3], dwc = TRUE)
glimpse(x)
```

    ## Rows: 9,704
    ## Columns: 13
    ## $ occurrenceID         <chr> "6CF446C4-4B65-145C-E053-2614A8C003BC", "27340.SP…
    ## $ basisOfRecord        <chr> "HUMAN_OBSERVATION", "HUMAN_OBSERVATION", "HUMAN_…
    ## $ scientificName       <chr> "Squalus acanthias acanthias", "Squalus acanthias…
    ## $ eventDate            <date> 4077342-05-23, 2080353-07-17, 2081299-10-05, 208…
    ## $ taxonRank            <chr> "SUBSPECIES", "SUBSPECIES", "SUBSPECIES", "SUBSPE…
    ## $ kingdom              <chr> "Animalia", "Animalia", "Animalia", "Animalia", "…
    ## $ decimalLatitude      <dbl> 47.49023, 47.26000, 47.08000, 40.07000, 40.18000,…
    ## $ decimalLongitude     <dbl> -6.18211, -58.44000, -58.21000, -72.82000, -72.25…
    ## $ geodeticDatum        <chr> "WGS84", "WGS84", "WGS84", "WGS84", "WGS84", "WGS…
    ## $ countryCode          <chr> "FR", "CA", "CA", "US", "US", "US", "US", "US", "…
    ## $ individualCount      <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
    ## $ organismQuantity     <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
    ## $ organismQuantityType <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…

And plot…

``` r
plot_gbif(x, what = 'ggplot')
```

![](README_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->
